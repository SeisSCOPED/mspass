

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mspasspy.io &mdash; MsPASS 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mspasspy.history" href="mspasspy.history.html" />
    <link rel="prev" title="mspasspy.db" href="mspasspy.db.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MsPASS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_manual.html">User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../reference_manual.html">Reference Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../reference_manual.html#python-api">Python API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mspasspy.ccore.html">mspasspy.ccore</a></li>
<li class="toctree-l3"><a class="reference internal" href="mspasspy.db.html">mspasspy.db</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">mspasspy.io</a></li>
<li class="toctree-l3"><a class="reference internal" href="mspasspy.history.html">mspasspy.history</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference_manual.html#c-api">C++ API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference_manual.html#mspass-schema">MsPASS Schema</a></li>
</ul>
</li>
</ul>

            
          
    <a href= "../genindex.html">Index</a>
  
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MsPASS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../reference_manual.html">Reference Manual</a> &raquo;</li>
        
      <li>mspasspy.io</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/python_api/mspasspy.io.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-mspasspy.io.converter">
<span id="mspasspy-io"></span><h1>mspasspy.io<a class="headerlink" href="#module-mspasspy.io.converter" title="Permalink to this headline">¶</a></h1>
<p>Functions for converting to and from MsPASS data types.</p>
<dl class="py function">
<dt id="mspasspy.io.converter.Metadata2dict">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">Metadata2dict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">md</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.Metadata2dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a Metadata object to a Python dict.</p>
<p>This is the inverse of dict2Metadata.  It converts a Metadata object to
a Python dict. Note that Metadata behavies like dict, so this conversion
is usually not necessay.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>md</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Metadata</span></code>) – Metadata object to convert.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Python dict equivalent to md.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.Seismogram2Stream">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">Seismogram2Stream</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sg</span></em>, <em class="sig-param"><span class="n">chanmap</span><span class="o">=</span><span class="default_value">['E', 'N', 'Z']</span></em>, <em class="sig-param"><span class="n">hang</span><span class="o">=</span><span class="default_value">[90.0, 0.0, 0.0]</span></em>, <em class="sig-param"><span class="n">vang</span><span class="o">=</span><span class="default_value">[90.0, 90.0, 0.0]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.Seismogram2Stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a mspass::Seismogram object to an obspy::Stream with 3 components split apart.</p>
<p>mspass and obspy have completely incompatible approaches to handling three
component data.  obspy uses a Stream object that is a wrapper around and
a list of Trace objects.  mspass stores 3C data bundled into a matrix
container.   This function takes the matrix container apart and produces
the three Trace objects obspy want to define 3C data.   The caller is
responsible for how they handle bundling the output.</p>
<p>A very dark side of this function is any error log entries in the part
mspass Seismogram object will be lost in this conversion as obspy
does not implement that concept.  If you need to save the error log
you will need to save the input of this function to MongoDB to preserve
the errorlog it may contain.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sg</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code>) – is the Seismogram object to be converted</p></li>
<li><p><strong>chanmap</strong> (<em>list</em>) – 3 element list of channel names to be assigned components</p></li>
<li><p><strong>hang</strong> (<em>list</em>) – 3 element list of horizontal angle attributes (azimuth in degrees)
to be set in Stats array of output for each component.  (default is
for cardinal directions)</p></li>
<li><p><strong>vang</strong> (<em>list</em>) – 3 element list of vertical angle (theta of spherical coordinates)
to be set in Stats array of output for each component.  (default is
for cardinal directions)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>obspy Stream object containing a list of 3 Trace objects in
mspass component order. Presently the data are ALWAYS returned to
cardinal directions (see above). It will be empty if sg was marked dead</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">obspy.core.stream.Stream</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.SeismogramEnsemble2Stream">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">SeismogramEnsemble2Stream</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sge</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.SeismogramEnsemble2Stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a seismogram ensemble to stream
:param sge: seismogram ensemble input
:return: stream</p>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.Stream2Seismogram">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">Stream2Seismogram</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">st</span></em>, <em class="sig-param"><span class="n">master</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">cardinal</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">azimuth</span><span class="o">=</span><span class="default_value">'azimuth'</span></em>, <em class="sig-param"><span class="n">dip</span><span class="o">=</span><span class="default_value">'dip'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.Stream2Seismogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert obspy Stream to a Seismogram.</p>
<p>Convert an obspy Stream object with 3 components to a mspass::Seismogram
(three-component data) object.  This implementation actually converts
each component first to a TimeSeries and then calls a C++ function to
assemble the complete Seismogram.   This has some inefficiencies, but
the assumption is this function is called early on in a processing chain
to build a raw data set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>st</strong> – input obspy Stream object.  The object MUST have exactly 3 components
or the function will throw a AssertionError exception.  The program is
less dogmatic about start times and number of samples as these are
handled by the C++ function this python script calls.  Be warned,
however, that the C++ function can throw a MsPASSrror exception that
should be handled separately.</p></li>
<li><p><strong>master</strong> – a Seismogram is an assembly of three channels composed created from
three TimeSeries/Trace objects.   Each component may have different
metadata (e.g. orientation data) and common metadata (e.g. station
coordinates).   To assemble a Seismogram a decision has to be made on
which component has the definitive common metadata.   We use a simple
algorithm and clone the data from one component defined by this index.
Must be 0,1, or 2 or the function wil throw a RuntimeError.  Default is 0.</p></li>
<li><p><strong>cardinal</strong> – boolean used to define one of two algorithms used to assemble the
bundle.  When true the three input components are assumed to be in
cardinal directions (x1=positive east, x2=positive north, and x3=positive up)
AND in a fixed order of E,N,Z. Otherwise the Metadata fetched with
the azimuth and dip keys are used for orientation.</p></li>
<li><p><strong>azimuth</strong> – defines the Metadata key used to fetch the azimuth angle
used to define the orientation of each component Trace object.
Default is ‘azimuth’ used by obspy.   Note azimuth=hang in css3.0.
Cannot be aliased - must be present in obspy Stats unless cardinal is true</p></li>
<li><p><strong>dip</strong> – defines the Metadata key used to fetch the vertical angle orientation
of each data component.  Vertical angle (vang in css3.0) is exactly
the same as theta in spherical coordinates.  Default is obspy ‘dip’
key. Cannot be aliased - must be defined in obspy Stats unless
cardinal is true</p></li>
</ul>
</dd>
<dt class="field-even">Raise</dt>
<dd class="field-even"><p>Can throw either an AssertionError or MsPASSrror(currently defaulted to</p>
</dd>
</dl>
<p>pybind11’s default RuntimeError.  Error message can be obtained by
calling the what method of RuntimeError).</p>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.Stream2SeismogramEnsemble">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">Stream2SeismogramEnsemble</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stream</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.Stream2SeismogramEnsemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a stream to seismogram ensemble.
:param stream: stream input
:return: converted seismogram ensemble</p>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.Stream2TimeSeriesEnsemble">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">Stream2TimeSeriesEnsemble</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stream</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.Stream2TimeSeriesEnsemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a stream to timeseries ensemble.
:param stream: stream input
:return: converted timeseries ensemble</p>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.TimeSeries2Trace">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">TimeSeries2Trace</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ts</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.TimeSeries2Trace" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a TimeSeries object to an obspy Trace object.</p>
<p>MsPASS can handle scalar data either as an obspy Trace object or
as with the mspass TimeSeries object.  The capture nearly the same
concepts.  The main difference is that TimeSeries support the
error logging and history features of mspass while obspy, which is
a separate package, does not.  Obspy has a number of useful
algorithms that operate on scalar data, however, so it is frequently
useful to switch between Trace and TimeSeries formats.  The user is
warned, however, that converting a TimeSeries to a Trace object
with this function will result in the loss of any error log information.
For production runs unless the data set is huge, we recommend saving
the intermediate result AFTER calling this function if there is any
possibility there are errors posted on any data.  We say after because
some warning errors from this function may be posted in elog.  Since
python uses call by reference d may thus be altered.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ts</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">TimeSeries</span></code>) – is the TimeSeries object to be converted</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>an obspy Trace object from conversion of d.  An empty Trace
object will be returned if d was marked dead</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.TimeSeriesEnsemble2Stream">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">TimeSeriesEnsemble2Stream</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tse</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.TimeSeriesEnsemble2Stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a timeseries ensemble to stream.
:param tse: timeseries ensemble
:return: converted stream</p>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.Trace2TimeSeries">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">Trace2TimeSeries</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">trace</span></em>, <em class="sig-param"><span class="n">history</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.Trace2TimeSeries" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert an obspy Trace object to a TimeSeries object.</p>
<p>An obspy Trace object mostly maps directly into the mspass TimeSeries
object with the stats of Trace mapping (almost) directly to the TimeSeries
Metadata object that is a base class to TimeSeries.  A deep copy of the
data vector in the original Trace is made to the result. That copy is
done in C++ for speed (we found a 100+ fold speedup using that mechanism
instead of a simple python loop)  There is one important type collision
in copying obspy starttime and endtime stats fields.  obspy uses their
UTCDateTime object to hold time but TimeSeries only supports an epoch
time (UTCDateTime.timestamp) so the code here has to convert from the
UTCDateTime to epoch time in the TimeSeries.  Note in a TimeSeries
starttime is the t0 attribute.</p>
<p>The biggest mismatch in Trace and TimeSeries is that Trace has no concept
of object level history as used in mspass.   That history must be maintained
outside obspy.  To maintain full history the user must pass the
history maintained externally through the optional history parameter.
The contents of history will be loaded directly into the result with
no sanity checks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trace</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code>) – obspy trace object to convert</p></li>
<li><p><strong>history</strong> – mspass ProcessingHistory object to post to result.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TimeSeries object derived from obpsy input Trace object</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeSeries</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mspasspy.io.converter.dict2Metadata">
<code class="sig-prename descclassname">mspasspy.io.converter.</code><code class="sig-name descname">dict2Metadata</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dic</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.converter.dict2Metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to convert Python dict data to Metadata.</p>
<p>pymongo returns a Python dict container from find queries to any collection.
Simple type in returned documents can be converted to Metadata
that are used as headers in the C++ components of mspass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dict</strong> (<em>dict</em>) – Python dict to convert</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Metadata object translated from d</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Metadata</span></code></p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-mspasspy.io.seispp"></span><dl class="py function">
<dt id="mspasspy.io.seispp.index_data">
<code class="sig-prename descclassname">mspasspy.io.seispp.</code><code class="sig-name descname">index_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filebase</span></em>, <em class="sig-param"><span class="n">db</span></em>, <em class="sig-param"><span class="n">ext</span><span class="o">=</span><span class="default_value">'d3C'</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.io.seispp.index_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Import function for data from antelope export_to_mspass.</p>
<p>This function is an import function for Seismogram objects created 
by the antelope program export_to_mspass.  That program writes 
header data as a yaml file and the sample data as a raw binary 
fwrite of the data matrix (stored in fortran order but written 
as a contiguous block of 3*npts (number of samples) double values. 
This function parses the yaml file and adds three critical metadata
entries:  dfile, dir, and foff. To get foff values the function 
reads the binary data file and gets foff values by calls to tell.  
It then writes these entries into MongoDB in the wf collection
of a database.   Readers that want to read this raw data will 
need to use dir, dfile, and foff to find the right file and read point.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filebase</strong> – is the base name of the dataset to be read and indexed.
The function will look for filebase.yaml for the header data and
filebase.ext (Arg 3 defaulting to d3C).</p></li>
<li><p><strong>db</strong> – is the MongoDB database handler</p></li>
<li><p><strong>ext</strong> – is the file extension for the sample data (default is ‘d3C’).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mspasspy.history.html" class="btn btn-neutral float-right" title="mspasspy.history" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mspasspy.db.html" class="btn btn-neutral float-left" title="mspasspy.db" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Ian Wang

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>