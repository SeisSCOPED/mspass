

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mspasspy.db &mdash; MsPASS 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mspasspy.io" href="mspasspy.io.html" />
    <link rel="prev" title="mspasspy.ccore" href="mspasspy.ccore.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MsPASS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_manual.html">User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../reference_manual.html">Reference Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../reference_manual.html#python-api">Python API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mspasspy.ccore.html">mspasspy.ccore</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">mspasspy.db</a></li>
<li class="toctree-l3"><a class="reference internal" href="mspasspy.io.html">mspasspy.io</a></li>
<li class="toctree-l3"><a class="reference internal" href="mspasspy.history.html">mspasspy.history</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference_manual.html#c-api">C++ API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference_manual.html#mspass-schema">MsPASS Schema</a></li>
</ul>
</li>
</ul>

            
          
    <a href= "../genindex.html">Index</a>
  
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MsPASS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../reference_manual.html">Reference Manual</a> &raquo;</li>
        
      <li>mspasspy.db</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/python_api/mspasspy.db.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-mspasspy.db">
<span id="mspasspy-db"></span><h1>mspasspy.db<a class="headerlink" href="#module-mspasspy.db" title="Permalink to this headline">¶</a></h1>
<p>Tools for connecting to MongoDB.</p>
<dl class="py class">
<dt id="mspasspy.db.Client">
<em class="property">class </em><code class="sig-prename descclassname">mspasspy.db.</code><code class="sig-name descname">Client</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Client" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">pymongo.mongo_client.MongoClient</span></code></p>
<p>A client-side representation of MongoDB.</p>
<p>This is a wrapper around the <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> for convenience.</p>
<dl class="py method">
<dt id="mspasspy.db.Client.get_database">
<code class="sig-name descname">get_database</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">codec_options</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">read_preference</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">write_concern</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">read_concern</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Client.get_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a <code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code> with the given name and
options.</p>
<p>Useful for creating a <code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code> with
different codec options, read preference, and/or write concern from
this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">read_preference</span>
<span class="go">Primary()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db1</span><span class="o">.</span><span class="n">read_preference</span>
<span class="go">Primary()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">ReadPreference</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_database</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">read_preference</span><span class="o">=</span><span class="n">ReadPreference</span><span class="o">.</span><span class="n">SECONDARY</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db2</span><span class="o">.</span><span class="n">read_preference</span>
<span class="go">Secondary(tag_sets=None)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><cite>name</cite> (optional): The name of the database - a string. If <code class="docutils literal notranslate"><span class="pre">None</span></code>
(the default) the database named in the MongoDB connection URI is
returned.</p></li>
<li><p><cite>codec_options</cite> (optional): An instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">CodecOptions</span></code>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">codec_options</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_preference</cite> (optional): The read preference to use. If
<code class="docutils literal notranslate"><span class="pre">None</span></code> (the default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_preference</span></code> of this
<code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is used. See <code class="xref py py-mod docutils literal notranslate"><span class="pre">read_preferences</span></code>
for options.</p></li>
<li><p><cite>write_concern</cite> (optional): An instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">WriteConcern</span></code>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">write_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_concern</cite> (optional): An instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">ReadConcern</span></code>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.5: </span>The <cite>name</cite> parameter is now optional, defaulting to the database
named in the MongoDB connection URI.</p>
</div>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Client.get_default_database">
<code class="sig-name descname">get_default_database</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">default</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">codec_options</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">read_preference</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">write_concern</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">read_concern</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Client.get_default_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the database named in the MongoDB connection URI.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">uri</span> <span class="o">=</span> <span class="s1">&#39;mongodb://host/my_database&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_default_database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">db</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_database&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">db</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_database&#39;</span>
</pre></div>
</div>
<p>Useful in scripts where you want to choose which database to use
based only on the URI in a configuration file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><cite>default</cite> (optional): the database name to use if no database name
was provided in the URI.</p></li>
<li><p><cite>codec_options</cite> (optional): An instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">CodecOptions</span></code>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">codec_options</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_preference</cite> (optional): The read preference to use. If
<code class="docutils literal notranslate"><span class="pre">None</span></code> (the default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_preference</span></code> of this
<code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is used. See <code class="xref py py-mod docutils literal notranslate"><span class="pre">read_preferences</span></code>
for options.</p></li>
<li><p><cite>write_concern</cite> (optional): An instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">WriteConcern</span></code>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">write_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_concern</cite> (optional): An instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">ReadConcern</span></code>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.8: </span>Undeprecated. Added the <code class="docutils literal notranslate"><span class="pre">default</span></code>, <code class="docutils literal notranslate"><span class="pre">codec_options</span></code>,
<code class="docutils literal notranslate"><span class="pre">read_preference</span></code>, <code class="docutils literal notranslate"><span class="pre">write_concern</span></code> and <code class="docutils literal notranslate"><span class="pre">read_concern</span></code>
parameters.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.5: </span>Deprecated, use <a class="reference internal" href="#mspasspy.db.Client.get_database" title="mspasspy.db.Client.get_database"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_database()</span></code></a> instead.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="mspasspy.db.Database">
<em class="property">class </em><code class="sig-prename descclassname">mspasspy.db.</code><code class="sig-name descname">Database</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">pymongo.database.Database</span></code></p>
<p>A MongoDB database handler.</p>
<p>This is a wrapper around the <code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code> with
methods added to handle MsPASS data.  The one and only constructor
uses a database handle normally created with a variant of this pair
of commands:</p>
<blockquote>
<div><p>client=MongoClient()
db=client[‘databasename’]</p>
</div></blockquote>
<p>where databasename is variable and the name of the database you
wish to access with this handle.</p>
<dl class="py method">
<dt id="mspasspy.db.Database.load3C">
<code class="sig-name descname">load3C</code><span class="sig-paren">(</span><em class="sig-param">oid</em>, <em class="sig-param">mdef=&lt;mspasspy.ccore.utility.MetadataDefinitions object&gt;</em>, <em class="sig-param">smode='gridfs'</em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.load3C" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a Seismogram object from MongoDB based on ObjectId.</p>
<p>This is a core reader for Seismogram objects with MongoDB.  The unique
document in the wf collection is selected by ObjectID (oid arg).
That oid is used to select a unique waveform document.
Samples can be read from system files or from gridfs.</p>
<p>A string attribute extracted from the database with the key ‘storage_mode’ is
normally used to tell the mode to use to fetch the sample
data.   If that attribute is not found the method defined in the smode
argument will be attempted.   When smode is gridfs, the method will
load the Metadata from the wf collection which must include the string attribute
wf_id.   It access the sample data from the gridfs_wf
collection after creating a buffer space for the sample data.
when smod is file the sample data is read by a C++ function that
uses a raw binary read.</p>
<p>This method was designed to never abort.  If the read failed the
boolean attribute of Seismogram called ‘live’ will be set false.
Both fatal and nonfatal errors will be posted to the elog member of
Seismogram.  Callers should test live and handle fatal and nonfatal
errors as appropriate to the algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>oid</strong> – is the ObjectId in the wf collection to be read</p></li>
<li><p><strong>mdef</strong> – is a MetadataDefinitions object used to validate types stored
in the database against what is expected for a given name.
In reading this is a necessary cross check to reduce errors
from incorrect expectations of the contents of a name:value pair
found in the document associated with this waveform.</p></li>
<li><p><strong>smode</strong> – sets the expected method for saving sample data.
(Metadata are normally stored in a single document of the wf collection)
Supported values at present are ‘file’ and ‘gridfs’ matching
allowed values for the storage_mode attribute.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Seismogram data object loaded.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Seismogram</p>
</dd>
<dt class="field-even">Raise</dt>
<dd class="field-even"><p>May throw a RuntimeError exception in one of several</p>
</dd>
</dl>
<p>error conditions.   Nonfatal errors will be posted to the error
log on the returned object.</p>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.load_event">
<code class="sig-name descname">load_event</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">source_id</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.load_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a bson record of source data matching the unique id
defined by source_id.   The idea is that magic string would
be extraced from another document (e.g. in an arrival collection)
and used to look up the event with which it is associated in
the source collection.</p>
<p>This function is a relic and may be depricated.  I originally
had a different purpose.</p>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.load_inventory">
<code class="sig-name descname">load_inventory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">net</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sta</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">loc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">time</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.load_inventory" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an obspy inventory object limited by one or more
keys.   Default is to load the entire contents of the
site collection.   Note the load creates an obspy
inventory object that is returned.  Use load_stations
to return the raw data used to construct an Inventory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>net</strong> – network name query string.  Can be a single</p>
</dd>
</dl>
<p>unique net code or use MongoDB’s expression query
mechanism (e.g. “{‘$gt’ : 42}).  Default is all
:param sta: statoin name query string.  Can be a single
station name or a MongoDB query expression.
:param loc:  loc code to select.  Can be a single unique
location (e.g. ‘01’) or a MongoDB expression query.
:param time:   limit return to stations with
startime&lt;time&lt;endtime.  Input is assumed an
epoch time NOT an obspy UTCDateTime. Use a conversion
to epoch time if necessary.
:return:  obspy Inventory of all stations matching the
query parameters
:rtype:  obspy Inventory</p>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.load_seed_channel">
<code class="sig-name descname">load_seed_channel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">net</span></em>, <em class="sig-param"><span class="n">sta</span></em>, <em class="sig-param"><span class="n">chan</span></em>, <em class="sig-param"><span class="n">loc</span><span class="o">=</span><span class="default_value">'NONE'</span></em>, <em class="sig-param"><span class="n">time</span><span class="o">=</span><span class="default_value">- 1.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.load_seed_channel" title="Permalink to this definition">¶</a></dt>
<dd><p>The channel collection is assumed to have a one to one
mapping of net:sta:loc:chan:starttime - endtime.
This method uses a restricted query to match the
keys given and returns a dict of the document contents
associated with that key.
The (optional) time arg is used for a range match to find
period between the site startime and endtime.  If not used
the first occurence will be returned (usually ill adivsed)
Returns None if there is no match.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>net</strong> – network name to match</p></li>
<li><p><strong>sta</strong> – station name to match</p></li>
<li><p><strong>chan</strong> – seed channel code to match</p></li>
<li><p><strong>loc</strong> – optional loc code to made (empty string ok and common)</p></li>
</ul>
</dd>
</dl>
<p>default ignores loc in query.
:param time: epoch time for requested metadata</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>handle to query return</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>MondoDB Cursor object of query result.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.load_seed_station">
<code class="sig-name descname">load_seed_station</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">net</span></em>, <em class="sig-param"><span class="n">sta</span></em>, <em class="sig-param"><span class="n">loc</span><span class="o">=</span><span class="default_value">'NONE'</span></em>, <em class="sig-param"><span class="n">time</span><span class="o">=</span><span class="default_value">- 1.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.load_seed_station" title="Permalink to this definition">¶</a></dt>
<dd><p>The site collection is assumed to have a one to one
mapping of net:sta:loc:starttime - endtime.
This method uses a restricted query to match the
keys given and returns a dict of coordinate data;
lat, lon, elev, edepth.
The (optional) time arg is used for a range match to find
period between the site startime and endtime.
Returns None if there is no match.</p>
<p>The seed modifier in the name is to emphasize this method is
for data originating as the SEED format that use net:sta:loc:chan
as the primary index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>net</strong> – network name to match</p></li>
<li><p><strong>sta</strong> – station name to match</p></li>
<li><p><strong>loc</strong> – optional loc code to made (empty string ok and common)</p></li>
</ul>
</dd>
</dl>
<p>default ignores loc in query.
:param time: epoch time for requested metadata</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>handle to query result</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>MondoDB Cursor object of query result.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.read_data">
<code class="sig-name descname">read_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">object_id</span></em>, <em class="sig-param"><span class="n">collection</span><span class="o">=</span><span class="default_value">'wf'</span></em>, <em class="sig-param"><span class="n">load_history</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">metadata_def</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.read_data" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metadata_def</strong> – </p></li>
<li><p><strong>load_history</strong> – </p></li>
<li><p><strong>object_id</strong> (<em>ObjectId</em>) – </p></li>
<li><p><strong>collection</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.save3C">
<code class="sig-name descname">save3C</code><span class="sig-paren">(</span><em class="sig-param">d</em>, <em class="sig-param">mdef=&lt;mspasspy.ccore.utility.MetadataDefinitions object&gt;</em>, <em class="sig-param">smode='gridfs'</em>, <em class="sig-param">mmode='save'</em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.save3C" title="Permalink to this definition">¶</a></dt>
<dd><p>Save mspass::Seismogram object in MongoDB.</p>
<p>This is a core method to save Seismogram objects in MongoDB.   It uses a
feature in the C library (MongoDBConverter) along with capabilities built
into the data object to add two important features:  (1) we can do pure
updates to database attributes for pure Metadata procedures as well as full
writes of new data, and (2) Seismogram has an error log feature that is
dumped to a separate document (elog) if it has any entries.   Any data
with sever errors are silently dropped assuming the user will use the
error log document to backtrack problems.</p>
<p>This method will immediately attempt to
open a connection to the wf and elog collections.  An assumption of
that algorithm is that doing so is lightweight and the simplification of
a single argument is preferable to requiring two args that have to be
checked for consistency.  If you don’t want to clobber an existing
database just create an empty scratch database before calling this
method for the first time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – Seismogram object to be saved.  Not if d is marked dead (live false)
the method attempts to write an entry in elog to save the error
messages posted for that seismogram.</p></li>
<li><p><strong>mdef</strong> – is a MetadataDefinitions object for schema used by d</p></li>
<li><p><strong>smode</strong> – mnemonic for SamplelMODE.   Options are currently supported:</p></li>
</ul>
</dd>
</dl>
<ol class="arabic simple">
<li><p>‘file’ - use the dir and dfile attributes to write sample
data as a raw dump with fwrite.  File is ALWAYS appended so user
can either change dir and/or defile and write to a new file or
append to the parent data.   The method will fail if dir or
dfile are not defined in this mode.</p></li>
<li><p>‘gridfs’ - (default) data are stored internally in MongoDB’s gridfs system</p></li>
<li><p>‘unchanged’ - do not save the data.  This mode is required when mmode
is set to updatemd (used for pure Metadata manipulations for efficiency)</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mmode</strong> – mnemonic for MetadataMODE.   Supported options are:</p>
</dd>
</dl>
<ol class="arabic simple">
<li><p>‘save’ - contents are saved dropping all marked readonly (default)</p></li>
<li><p>‘saveall’ - all Metadata attributes are saved even if marked readonly
(most useful for temporary data saved inside a job stream)</p></li>
<li><p>‘updatemd’ - run an update to the document of Metadata that have
changed.  Nothing else is altered in this case. If smode is not set
unchanged the method will throw a RuntimeError exception in
the mode.  Similarly, if the ObjectID was set invalid, which is
used internally whenever sample data are altered, the method will
abort with a RuntimeError exception.</p></li>
<li><p>‘updateall’ - both Metadata and sample data will be updated.  Note
this mode should not be used if smode is set to ‘file’ as it is
nearly guaranteed to create inaccessible holes in files.  A
warning message is posted in this situation, but the program
will blunder on.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Number of errors posted to ErrorLogger and saved in the database</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>integer</p>
</dd>
<dt class="field-odd">Raise</dt>
<dd class="field-odd"><p>should be surrounded by a RuntimeError exception handler.  The method
can abort with several illegal argument combinations</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.save_catalog">
<code class="sig-name descname">save_catalog</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cat</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.save_catalog" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the contents of an obspy Catalog object to MongoDB
source collection.  All contents are saved even with
no checking for existing sources with duplicate
data.   Like the comparable save method for stations,
save_inventory, the assumption is pre or post cleanup
will be preformed if duplicates are a major issue.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cat</strong> – is the Catalog object to be saved</p></li>
<li><p><strong>verbose</strong> – Print informational data if true.</p></li>
</ul>
</dd>
</dl>
<p>When false (default) it does it’s work silently.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>integer count of number of items saved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.save_data">
<code class="sig-name descname">save_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mspass_object</span></em>, <em class="sig-param"><span class="n">storage_mode</span></em>, <em class="sig-param"><span class="n">update_all</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">dfile</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dir</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">exclude</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">collection</span><span class="o">=</span><span class="default_value">'wf'</span></em>, <em class="sig-param"><span class="n">metadata_def</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.save_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.save_inventory">
<code class="sig-name descname">save_inventory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inv</span></em>, <em class="sig-param"><span class="n">networks_to_exclude</span><span class="o">=</span><span class="default_value">['SY']</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.save_inventory" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves contents of all components of an obspy inventory
object to documents in the site and channel collections.
The site collection is sufficient of Seismogram objects but
TimeSeries data will often want to be connected to the
channel collection.   The algorithm used will not add
duplicates based on the following keys:</p>
<dl>
<dt>For site:</dt><dd><p>net
sta
chan
loc
starttime::endtime - this check is done cautiously with</p>
<blockquote>
<div><p>a 10 s fudge factor to avoid the issue of floating point
equal tests.   Probably overly paranoid since these
fields are normally rounded to a time at the beginning
of a utc day, but small cost to pay for stabilty because
this function is not expected to be run millions of times
on a huge collection.</p>
</div></blockquote>
</dd>
<dt>for channels:</dt><dd><p>net
sta
chan
loc
starttime::endtime - same approach as for site with same</p>
<blockquote>
<div><p>issues - note especially 10 s fudge factor.   This is
necessary because channel metadata can change more
frequently than site metadata (e.g. with a sensor
orientation or sensor swap)</p>
</div></blockquote>
</dd>
</dl>
<p>Finally note the site collection contains full response data
that can be obtained by extracting the data with the key
“serialized_inventory” and running pickle loads on the returned
string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>inv</strong> – is the obspy Inventory object of station data to save.</p>
</dd>
<dt class="field-even">Networks_to_exclude</dt>
<dd class="field-even"><p>should contain a list (or tuple) of
SEED 2 byte network codes that are to be ignored in
processing.   Default is SY which is used for synthetics.
Set to None if if all are to be loaded.</p>
</dd>
<dt class="field-odd">Verbose</dt>
<dd class="field-odd"><p>print informational lines if true.  If false</p>
</dd>
</dl>
<p>works silently)</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>tuple with
0 - integer number of site documents saved
1 -integer number of channel documents saved
2 - number of distinct site (net,sta,loc) items processed
3 - number of distinct channel items processed</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.set_metadata_definition">
<code class="sig-name descname">set_metadata_definition</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">definition</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.set_metadata_definition" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="mspasspy.db.Database.update_metadata">
<code class="sig-name descname">update_metadata</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">metadata_dict</span></em>, <em class="sig-param"><span class="n">update_all</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">exclude</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">collection</span><span class="o">=</span><span class="default_value">'wf'</span></em>, <em class="sig-param"><span class="n">metadata_def</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mspasspy.db.Database.update_metadata" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mspasspy.io.html" class="btn btn-neutral float-right" title="mspasspy.io" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mspasspy.ccore.html" class="btn btn-neutral float-left" title="mspasspy.ccore" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Ian Wang

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>